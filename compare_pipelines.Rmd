---
title: "Compare processing pipelines"
author: "Dan Yurovsky"
date: '`r Sys.Date()`'
output:
  html_document:
  highlight: tango
theme: sandstone
code_folding: show
toc: false
toc_float: false
---
  
```{r libraries}
library(udpipe)
library(feather)
library(here)
library(tidyverse)
library(glue)
```

```{r load-data}
# no prenominal
human_parsed_pairs <- read_csv(here("data/test_parser_utts_thousand_CB.csv")) %>%
  mutate(coded = "Claire") %>%
  bind_rows(read_csv(here("data/test_parser_utts_thousand_BM.csv")) %>%
              filter(!is.na(coded)) %>%
              mutate(coded = "Ben")) %>%
  rename(chat = p_chat) %>%
  unite(pair, adj, noun, sep = "_")

udpipe_parsed_pairs <- read_csv(here("data/ldp_parent_original_parsed_pairs.csv")) %>%
  select(adj_token, noun_token, sentence, chat) %>%
  rename(adj = adj_token, noun = noun_token) %>%
  unite(pair, adj, noun, sep = "_") %>%
  filter(chat %in% human_parsed_pairs$chat) %>%
  distinct(pair, sentence, chat)

missing <- human_parsed_pairs %>%
  filter(!chat %in% udpipe_parsed_pairs$chat )
```

```{r compute-F-udpipe}
no_pairs <- human_parsed_pairs %>% 
  filter(pair == "NA_NA") %>%
  nrow()

recall_items <- human_parsed_pairs %>%
  select(pair, chat) %>%
  semi_join(udpipe_parsed_pairs %>% select(pair, chat), by = c("pair", "chat"))

non_precision_items <- udpipe_parsed_pairs %>%
  select(pair, chat) %>%
  anti_join(human_parsed_pairs %>% select(pair, chat), by = c("pair", "chat"))

recall = (nrow(recall_items)) / (nrow(human_parsed_pairs) - no_pairs)
precision = (nrow(udpipe_parsed_pairs) - nrow(non_precision_items)) / nrow(udpipe_parsed_pairs)

f_score = 2 * ((precision * recall) / (precision + recall))
```

